---
title: Mes libs TypeScript du moment
date: 2024-08-21T17:00:00.000Z
description: >
  √âcrire du code OK, √©crire du TypeScript, pas OK, ou plut√¥t, le moins j'en
  √©cris, le mieux je me porte. Voici donc les libs qui me permettent d'en √©crire
  moins et qui me font profiter un maximum de l'inf√©rence de type.
published: true
tags:
  - typescript
  - zod
---

import LinkToCode from "@/components/LinkToCode.astro";
import { Information } from "@/components/Information";

Pour accompagner cet article, je te propose un son que j'ai d√©couvert en l'√©crivant et que je kiffe bien :

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/7Bf0RPsldDH7jVi9H3wODv?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="eager" title="Spotify embed player"></iframe>

Je dis souvent lors des formations TypeScript que je donne que le meilleur TypeScript que l‚Äôon produit, c‚Äôest celui que l‚Äôon n‚Äô√©crit pas.
Ce que j‚Äôentends par l√†, c‚Äôest que le meilleur moyen de profiter de TypeScript, c‚Äôest de profiter de son inf√©rence de types, parce qu'on ne va pas se mentir, personne n'aime maintenir des types.
Un des autres moyens d'√©crire du bon TS, c'est d'√©viter d'√©crire du code sp√©cifique √† TypeScript comme, par exemple, les `enum` ou les `namespace` qui sont une feature en plus qui devra √™tre traduit en JavaScript, mais qui ne se fait pas du tout en 1 pour 1.

La meilleure mani√®re de produire une application web √©crite en TS, c‚Äôest de mettre les types robustes au plus bas, ce qui est bien souvent la couche HTTP dans une application web, car il faut valider les entr√©es et sorties de notre application.
Entr√©es, √ßa veut aussi dire les formulaires pour v√©rifier les entr√©es utilisateur¬∑ice¬∑s.

Et pour cela, commen√ßons par la premi√®re biblioth√®que que j‚Äôutilise en ce moment (depuis quelques temps maintenant, mais √ßa fait quelques ann√©es que je n‚Äôai pas √©crit d‚Äôarticle).

## zod

Si tu es d√©veloppeur¬∑euse web, que tu fais du d√©veloppement en TypeScript et que tu ne connais pas encore `zod`, je t‚Äôinvite fortement √† lire la suite !
`zod` est un outil permettant de faire des sch√©ma de validation en TypeScript et de profiter d‚Äôune inf√©rence de type statique, je m‚Äôen sers pour valider les donn√©es que je re√ßois d‚Äôune API, ce qui me permet de voir que le contrat est respect√© au runtime, mais √©galement de profiter du typage statique lors du d√©veloppement.

Voyons ensemble mes conventions de d√©clarations de sch√©ma en prenant pour exemple le mod√®le de personnage de l‚Äô[API de Rick et Morty](https://rickandmortyapi.com/documentation#character) :

```ts
import { z } from "astro:content";

export const zCharacter = () =>
  z.object({
    id: z.number().int().positive(),
    name: z.string(),
    status: z.enum(["Alive", "Dead", "unknown"]),
    species: z.string(),
    type: z.string(),
    gender: z.enum(["Female", "Male", "Genderless", "unknown"]),
    origin: z.object({
      name: z.string(),
      url: z.string().url(),
    }),
    location: z.object({
      name: z.string(),
      url: z.string().url(),
    }),
    image: z.string().url(),
    episode: z.array(z.string().url()),
    url: z.string().url(),
    created: z.date(),
  });

const data = {
    "id": 361,
    "name": "Toxic Rick",
    "status": "Dead",
    "species": "Humanoid",
    "type": "Rick's Toxic Side",
    "gender": "Male",
    "origin": {
        "name": "Alien Spa",
        "url": "https://rickandmortyapi.com/api/location/64"
    },
    "location": {
        "name": "Earth",
        "url": "https://rickandmortyapi.com/api/location/20"
    },
    "image": "https://rickandmortyapi.com/api/character/avatar/361.jpeg",
    "episode": [
        "https://rickandmortyapi.com/api/episode/27"
    ],
    "url": "https://rickandmortyapi.com/api/character/361",
    "created": "2018-01-10T18:20:41.703Z"
}

const myCharacter = zCharacter().parse(data);
```
<LinkToCode
  href="https://www.typescriptlang.org/play/?#code/JYWwDg9gTgLgBAbzgLzgXzgMyhEcBEyEAJvgNwBQFApgB6SxwDGEAdgM7zIDCAFgIZR+TGNShwAvHAAUASkkA+CnBQA6CACMAVtRHSEylXGDEAXGtYBXEBrFzVwVjHuR2wGMABu1OQBpDKqz8INTmyKqcUI4A5n4BcJz8MJbsYarUViDSANr4AIIANl7U+L4EACLU-KRl+JasANasEADurPgAurL+RglgusDUqWqRMXG9MACe-WmjrLHd8dEZxGJpGdY5+ABi1CD8BSW1ALIHRwQA4itih+zspQT1Ta3tXT1G0MDRjmmaOnoGXqBYKhEYwKLzcZAyxQAqzcFjWSqGEFKEqNCLXoFCBMJLANi-bS6ZyAoFBELwiELd69FGUxHI2Fo9CYoygfjLemQpEo5nUMDAdgkUHhQRCSbScJzBaM1GyVkqOlgqn2XkK5hQKqiMxqYhJHysjGUCgsDjwPUwfiSRDxfAmfDmADMADYAIw0gjkkrmfAAFQgtGATDgACUgw1SrbEsl7j7KtVI718Ox+kxBrGCAAJaz8Zr2j34Kb9B0EMNMBoAcnYcH9geDAGUTEdbctWKsoCX8KdDomjPhPt92uZSUDPSDO4VBqw4PWwPxe6O6rDO7wYDAwKkAPSbqLl3PEEDQKb8AWqFggTcn4Cb7G4jxsTfOgAs+HiaALt7xbBLI6B+C9nYAKKCDAvALn+KIrmuG6mNuu4NPuh6wJMV5nrgl4CjeOJfqwm4AEwAAyvr0762uyyxQeuW47uGiFHihp7nhh15MAIQgiGIl6eEkgibi6rqqFo-TROB+D8oKwoltk8RJquVGwTRe5tkhx6MehV6buJQqrPhADsxFGB0BaQT6ckwXBtHKfRqFMRprGCMIohQHxbqiUwmr6qQPqEa6AAcAC0BGuv5roEb6fmmIRphPgJukEY6ABar5oFQpqcHAICTHwDkceIUg8Gxjl2Eic5QOwPgWvwsiUKO25wAAegA-EAA"
>Lien vers le Playground TypeScript avec ce code</LinkToCode>

On voit donc la convention en `zMonEntite` sous forme de fonction pour garder le concept de base de zod et de pouvoir passer d‚Äô√©ventuels param√®tres √† l‚Äôavenir.

Suite √† la d√©claration du sch√©ma, je l'utilise pour _parser_ directement les donn√©es que je re√ßois dans mes services, ce qui me permet de profiter de l‚Äôinf√©rence de type dans ces services et de profiter du typage de bout en bout jusqu‚Äô√† mes pages dans lesquelles j‚Äôutilise mes [`useQuery`](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery) (de [TanStack Query](https://tanstack.com/query/latest)) d√©clar√©s et inf√©r√©s.

Ces sch√©mas me servent √©galement √† valider mes formulaires depuis que j‚Äôutilise React Hook Form, bien pratique car mes donn√©es sont directement valid√©es √† partir des entr√©es utilisateur¬∑ice¬∑s jusqu‚Äô√† l‚ÄôAPI.

Je ne vais pas faire le tour de toute les fonctionnalit√©s de `zod` dans cet article car ce serait bien trop long, mais je t‚Äôinvite fortement √† le tester dans un [Playground TypeScript](https://www.typescriptlang.org/play).

<Information>Il est possible d‚Äôutiliser des d√©pendances dans les Playground TypeScript, √©crit l‚Äôimport et √ßa va aller r√©cup√©rer la d√©pendance automatiquement pour que tu puisses jouer avec directement dans le Playground.</Information>

## Boxed

Une lib que j‚Äôutilise un peu moins mais que je trouve bien pratique de temps en temps, qui s‚Äôinspire de la programmation fonctionnelle, c‚Äôest [Boxed](https://swan-io.github.io/boxed/) par l‚Äô√©quipe de chez [Swan](https://www.swan.io/).

Elle permet de mettre en place des structures relativement classique pour faire de la programmation fonctionnelle, ce qui me rappelle [mes petites sessions de Rust](https://www.bearstudio.fr/blog/developpement/rust). On y retrouve `Result`, bien pratique dans le cas de l'√©criture d'une fonction pour laquelle on a de la gestion d'erreur et `Option` pour les fonctions les plus basses pour lesquelles on retournerait par exemple `null`, `undefined`.
Ces derni√®res sont deux ‚Äúvaleurs‚Äù que je tente de retirer de plus en plus de mon code pour m‚Äôassurer une _type-safety_ au maximum.

Une autre structure que j‚Äôaime beaucoup, et que j‚Äôai utilis√© encore r√©cemment chez un client, c‚Äôest `AsyncData` qui permet d‚Äôavoir plusieurs √©tats asynchrone et de g√©rer une logique diff√©rente en fonction des cas:

* `NotAsked`: pas d‚Äôaction de la part des utilisateur¬∑ice¬∑s (ou pas d‚Äôaction tout court)
* `Loading`: action asynchrone en cours, permet de g√©rer des √©tats de loading
* `Done(value)`: l‚Äôaction est termin√©e et on peut r√©cup√©rer la valeur encapsul√©e dans la structure

Bref, c‚Äôest pas mal de petites chose qui vont t‚Äôaider pour que ta base de code soit la plus _type-safe_ possible.
Cette structure g√®re √©galement une interop√©rabilit√© avec la prochaine d√©pendance que je vais te pr√©senter : `ts-pattern` !

## TS Pattern

Quand j‚Äôai essay√© Rust pour la premi√®re fois, j‚Äôai ador√© le _pattern matching_, c‚Äôest une structure de contr√¥le de donn√©e que je ne connaissais pas, et voil√† que je la retrouve en TypeScript gr√¢ce √† cette lib ! C‚Äôest bien pratique, et je vais tout de suite t‚Äôexpliquer pourquoi !

Pas plus tard que le jour o√π je r√©dige ces lignes, je suis tomb√© sur le bout de code suivant:

```ts
const displayValue = value === undefined
  ? '---'
  : value === true
  ? 'true'
  : value === false
  ? 'false'
  : value;
```

Plusieurs probl√®mes:

1. C‚Äôest difficilement lisible
2. C‚Äôest difficilement maintenable
3. On couvre peut √™tre pas tous les cas qui correspondent au type de `value` et on est m√™me pas averti

C‚Äôest dans ce genre de cas que `ts-pattern` entre en jeu, en voici un exemple avec du code avant / apr√®s:

```ts
import { match, P } from 'ts-pattern';

type MyComponentProps = { value?: boolean | string | number };

const MyComponent = ({ value }: MyComponentProps) => {
  // Ternaire
  const displayValue = value === undefined
    ? '---'
    : value === true
    ? 'true'
    : value === false
    ? 'false'
    : value;

  // Pattern Matching
  const d = match(value)
    .with(undefined, () => '---')
    .with(true, () => 'true')
    .with(false, () => 'false')
    .with(P.number, P.string, (v) => v)
    .exhaustive()
}
```
<LinkToCode href="https://www.typescriptlang.org/play/?#code/JYWwDg9gTgLgBAbziAhjAxgCwDRwApwC+cAZlBCHAOQwDOAtGGjAKZQB2VA3AFA8wBPMCzgBZAQGEKkdi3Yw85MLTgBeRHABuKADYBXFgH4AXHABGECDpYp2cAD5xaMKMHYBzB3HZ6QZtkS8POgQ7M5iktKhcvDqABRI2voihKbiUuDR8ooQygCUagB8iDxwcAD05XAAKmzsKMBQLKVwIWHwACbAtGA6KAIAaroGalrDIqqTcHrsHSwkbiwdLWWG1PQbVCtwpkkjk+ouBttrNFAGW2Vlu+NqUyS6tM1XcKcPOk+XVzfJQWWV+GYdTEaCwbncLTa4Q6o1QGEwcT2LDy2wAdAB3YAwBEzOYLWQdXBxAqqYpUDb0Kgol4YrEIo4sIkkskMqlozHYuLvJ5MorUbksNk0jkIvConx+Ni4MXOVweImaZlaalXVEsAAemBQemcwE0LGJPEIQA">Lien vers le Playground TypeScript avec ce code</LinkToCode>

On le voit directement, c‚Äôest notamment dans le `.exhaustive()` que r√©side la puissance de `ts-pattern`, car il nous permet de couvrir tous les cas et types de la variable, en effet, `.exhaustive()` va avoir un soucis de typage si on a oubli√© de g√©rer un des types de la variable.

Prenons un autre exemple avec du code de [üöÄ Start UI [web]](https://github.com/BearStudio/start-ui-web), un starter de projet dont je suis un des contributeurs.
On a un composant `Select` qui nous permet de g√©rer [diff√©rent type de `select`](https://github.com/BearStudio/start-ui-web/blob/4745ab66edb5c377102ff02292433039e3d33b0b/src/components/Select/index.tsx#L37-L43): `async`, `creatable`, `async-creatable` et le `select` classique.
L‚Äôavantage de `ts-pattern` ici par rapport √† un `switch` natif, c‚Äôest encore une fois de ne pas oublier de cas.
On est s√ªr que si un¬∑e d√©veloppeur¬∑euse ajoute un type de `Select`, alors TypeScript et `ts-pattern` ne valideront pas ces lignes et nous dirons qu‚Äôil y a un cas en plus √† g√©rer.

Encore une fois, je t‚Äôinvite vraiment √† voir tout ce qu‚Äôil est possible de faire avec cette lib, y a beaucoup de fonctionnalit√©s sympa qui m√©ritent le d√©tour !

## Remeda

Je vais te la faire courte, `remeda`, c‚Äôest `lodash` √©crit en TypeScript pour TypeScript.
En prenant le code suivant, on se rends vite compte de la force de `remeda` par rapport √† `lodash` ou bien les fonctions natives JavaScript (avec le typage fourni par l'√©quipe de TypeScript) :

```ts
import { keys } from "remeda";
import { keys as lodashKeys } from "lodash";

const Routes = {
    Home: {
        label: "Home",
        link: "/",
    },
    About: {
        label: "About",
        link: "/about"
    }
}

// Typed ‚úÖ
const keyValues = keys(Routes);

// Poorly typed üòî
const keyValuesObject = Object.keys(Routes);

// Poorly typed üòî
const keyValuesLodash = lodashKeys(Routes);
```
<LinkToCode
  href="https://www.typescriptlang.org/play/?ssl=25&ssc=14&pln=1&pc=1#code/JYWwDg9gTgLgBAbzgawKYE8DOcC+cBmUEIcA5FKiKgCYCGpA3AFCiSyIoba3YA2EdTAAsA0l1wEiJUv0FDGTJgGMIAO0zwAShACuMVNgC8iJnDNwAEsVQAuE+YdxetAEapedgERWqngDSmjma8wKrIXgD0-oFmOAEOAIIuujB2CDGOzm4ecJ5JKdFBwaHhuRGuBRk4TNVMERFwACroYDRwgKDkymoanOgAarS8OgZwxmhYABTaegYAlMxFcPVwAHoA-IrLAAoQ0LzocDAtbYC8G4Aoe13q8OMDQwYA8i4AVqhK8MaPL28AdOOYUyk5gsist1psGjs9gcjq1qHBzpcejdBsNMAAZAQ8ISjJyY4RiSbTfSYeYZBygtZAA"
>Lien vers le Playground TypeScript avec ce code</LinkToCode>

De plus `remeda` va √™tre un peu plus l√©ger que `lodash` (alors oui, il y a un peu moins de fonctions, mais j‚Äôavoue que pour l‚Äôinstant, j‚Äôai jamais manqu√© de fonctions avec `remeda`) ce qui est fortement appr√©ciable.

![Comparaison de la taille des d√©pendances](./bundlephobia.png)

Niveau API, je trouve √ßa bien sympa : soit on est en mode _data-first_ ce qui est plus naturel pour les devs, en mode appel de fonction sur les donn√©es et traitement en deuxi√®me genre `map(data, () => {})`, soit on est en mode _data-last_ gr√¢ce aux fonctions qui acceptent le [currying](https://stackoverflow.com/questions/36314/what-is-currying#36321), ce qui permet de faire plusieurs traitements de suite gr√¢ce √† la fonction `.pipe()` par exemple.

## Mention sp√©ciale: nuqs

Marre des sites qui ne gardent pas la pagination comme il faut ou ne gardent pas les informations de filtre et recherche quand tu recharges la page ?
La faute aux personnes qui impl√©mentent les sites avec des √©tats en m√©moire et pas dans l'URL parce qu'elles sont ignorantes, ou parce qu'elles trouvent √ßa gal√®re de g√©rer le typage et la logique pour le faire. 

C'est l√† que [`nuqs`](https://nuqs.47ng.com/) entre en jeu !
C'est une d√©pendance pour Next.js qui va te permettre de g√©rer tes √©tats dans l'URL, tout en aillant un fort typage avec de la (d√©)s√©rialisation.
Tu n'as plus aucune raison de ne pas utiliser l'URL pour g√©rer les √©tats qui le m√©rite !

Si tu veux en savoir plus sur `nuqs`, je t'invite √† aller voir [la conf√©rence (en anglais _my dear_) de son d√©veloppeur Fran√ßois Best](https://www.youtube.com/watch?v=6hD2SPP1eus).

<iframe width="560" height="315" src="https://www.youtube.com/embed/6hD2SPP1eus?si=rmFoiakpV0YG20uR" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>

J‚Äôesp√®re que cet article t‚Äôa plu ! Dans tous les cas, n'h√©site pas √† me le faire savoir sur X ou autres r√©seaux disponible dans le bas de page.
Si jamais tu veux un article d√©taill√© sur l'une des d√©pendances que j'ai pr√©sent√© ici, fais le moi savoir et je verrais ce que je peux faire.

A plus.
